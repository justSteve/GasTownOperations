# COO Handoff - 2026-01-20

## Your Role

You are the **Chief Operating Officer of GasTown**. This Operations Center (`/root/gtOps`, repo: `github.com/justSteve/GasTownOperations`) is your base. You need to orient yourself to the patterns and practices of that repository and also of the the relationship of this repo relates to the repo we are tasked with managing. The GT instance you manage lives at `/home/gtuser/gt`.

Your mission: **Expand understanding of how Gas Town works and grow alongside it.**

---

## What We Built This Session

### 1. VSCode Terminal Integration
Created keybindings and profiles to quickly open GT dashboard terminals in VSCode.

**Keybindings** (`%APPDATA%/Code/User/keybindings.json`):
| Shortcut | Action |
|----------|--------|
| `Ctrl+Shift+G, R` | Open gt-root terminal (red) |
| `Ctrl+Shift+G, U` | Open gt-user terminal (blue) |
| `Ctrl+Shift+G, M` | Move terminal to new window |

**Workflow**: Open terminal → Move to window → Repeat for second terminal. Position windows on second monitor - Windows remembers placement.

**Terminal Profiles** (in user settings.json):
- `gt-root`: Attaches to tmux gt-root session (red icon)
- `gt-user`: Attaches to tmux gt-user session (blue icon)

**Settings Changes**:
- `terminal.integrated.persistentSessionReviveProcess: "never"` - No ghost terminals on restart
- Profiles include `; exit 0` to suppress exit code warnings when closing

### 2. Terminal Logging
Automatic logging for main tmux panes with ANSI escape code filtering.

**Log Files** (`/root/gtOps/logs/`):
- `gt-root-shell.log` - Root shell activity
- `gt-root-monitor.log` - Root monitor pane
- `gt-user-shell.log` → symlink to `/var/log/gt/` (gtuser can't write to /root)
- `gt-user-mail.log` → symlink to `/var/log/gt/`

**Features**:
- ANSI escape codes stripped via `sed -u`
- Unbuffered output for real-time logging
- Auto log rotation via cron (midnight daily, 10MB max, 7-day retention)

**Log Rotation Script**: [daemon/gt-log-rotate.sh](daemon/gt-log-rotate.sh)

### 3. Documentation
Created [SHORTCUTS.md](SHORTCUTS.md) documenting all keybindings, terminal profiles, dashboard commands, and tmux navigation.

### 4. System Cleanup
- **Docker**: Removed all stopped containers, images, volumes (~10.2GB freed)
- **Services**: Disabled `docker` and `containerd` (not needed currently)
- **MOTD**: Disabled Ubuntu login banner scripts (was causing log noise)

---

## Key Discoveries

### VSCode Terminal Limitations
- `runCommands` has race conditions with async terminal operations
- Mouse scrolling doesn't pass through to tmux in VSCode terminals
- Terminal window positions are OS-managed, not VSCode-controlled
- Workspace terminal profiles need to also be in user settings for keybindings to work

### Tmux Scrollback
Mouse wheel doesn't work in VSCode terminals. Use keyboard:
- `Ctrl+B [` → Enter copy/scroll mode
- `PgUp/PgDn` or arrows → Navigate
- `q` → Exit back to normal

### User Isolation for Logging
gtuser can't write to `/root/gtOps/logs/` (can't traverse /root). Solution: logs go to `/var/log/gt/` with symlinks in `/root/gtOps/logs/`.

---

## Current State

### GT Dashboard
```bash
/root/gtOps/daemon/gt-dashboard.sh status
```
- `gt-root` session: **RUNNING** (root's tmux)
- `gt-user` session: **RUNNING** (gtuser's tmux)

### Services
- Docker: **DISABLED** (re-enable with `systemctl enable --now docker`)
- Containerd: **DISABLED**

### Logging
- Automatic for main panes
- Check with: `tail -f /root/gtOps/logs/gt-root-shell.log`

---

## Files Changed This Session

| File | Change |
|------|--------|
| `daemon/gt-dashboard.sh` | Added logging with sed filtering, horizontal splits |
| `daemon/gt-tmux.conf` | Added mouse, scrollback, logging toggle |
| `daemon/gt-log-rotate.sh` | **NEW** - Log rotation script |
| `.vscode/settings.json` | Terminal profiles for workspace |
| `SHORTCUTS.md` | **NEW** - Shortcuts documentation |
| `logs/` | **NEW** - Log directory with symlinks |

**Windows-side files**:
| File | Change |
|------|--------|
| `%APPDATA%/Code/User/settings.json` | Terminal profiles, disabled terminal persistence |
| `%APPDATA%/Code/User/keybindings.json` | GT terminal keybindings |

---

## Pending Work

### From Previous Session
- DReader Windows Migration
- Mayor/Deacon startup timing issues
- Dashboard enhancements (token graphs, polecat visualizer, etc.)

### From This Session
- Consider Windows Terminal as alternative to VSCode terminals (better tmux support)
- Log rotation could be enhanced with compression

---

## Quick Start for Next Session

```bash
# Check dashboard status
/root/gtOps/daemon/gt-dashboard.sh status

# If sessions not running, start them
/root/gtOps/daemon/gt-dashboard.sh

# Open terminals in VSCode
# Press: Ctrl+Shift+G, R → Ctrl+Shift+G, M (for root)
# Press: Ctrl+Shift+G, U → Ctrl+Shift+G, M (for user)

# Watch logs
tail -f /root/gtOps/logs/gt-root-shell.log

# Bring up the town
sudo -u gtuser bash -c 'cd /home/gtuser/gt && gt up'
```

---

*Handoff complete. Welcome, COO.*
